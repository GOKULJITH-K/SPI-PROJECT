##  Code Coverage – APB-SPI Core

This folder contains the **code coverage flow** for the APB-SPI Core using **Synopsys VCS**.  
Coverage ensures that the testbench exercises **all RTL modules** thoroughly and helps identify untested code paths.

---

##  What is Code Coverage?

Code coverage measures how much of the design is exercised during simulation:

- **Line coverage** → Did each RTL line execute?  
- **Branch coverage** → Were all `if/else` and `case` branches taken?  
- **Condition coverage** → Were all boolean sub-expressions evaluated both true and false?  
- **Toggle coverage** → Did each signal toggle `0→1` and `1→0`?  
- **FSM coverage** → Were all states and transitions of finite state machines visited?  

 **Branch vs Condition**:  
- *Branch coverage* only checks which branch of an `if/else` was taken.  
- *Condition coverage* goes deeper: for `if (a && b)`, it checks both `a` and `b` toggled through true/false values, not just the combined outcome.

---

##  Toolchain

- **Simulator:** Synopsys VCS  
- **Report generation:** URG (Unified Report Generator)  
- **Interactive exploration:** Verdi  

---

##  Makefile

```makefile
# RTL and TB paths (example for baud generator)
RTL = ../rtl/spi_baud_generator.v
TB  = ../tb/spi_baud_generator_tb.v

FSDB_PATH=/home/cad/eda/SYNOPSYS/VERDI_2022/verdi/T-2022.06-SP1/share/PLI/VCS/LINUX64

help:
	@echo ===========================================================================================================================
	@echo " USAGE   	--  make <target>"
	@echo " clean   	=>  clean logs and intermediate files."
	@echo " report  	=>  generate HTML/text coverage reports with URG."
	@echo " verdi   	=>  open coverage results in Verdi GUI."
	@echo ===========================================================================================================================

clean:
	rm -rf csrc .fsdb novas_dump.log simv* simv1.daidir ucli.key verdi* novas.* cm.log vdCov* *.vdb *.urg coverage_report
	clear

report:
  vcs $(RTL) $(TB) -cm line+cond+branch+tgl+fsm
	./simv -cm line+cond+branch+tgl+fsm
	urg -dir simv.vdb 

verdi:
    vcs $(RTL) $(TB) -cm line+cond+branch+tgl+fsm
	./simv -cm line+cond+branch+tgl+fsm
	urg -dir simv.vdb 
	verdi -cov -covdir simv.vdb

````

---

##  How to Run

1. **Clean previous runs**

   ```bash
   make clean
   ```
2. **Compile & simulate with coverage enabled**

   ```bash
   make run
   ```

   This produces `simv.vdb/` (coverage database).
3. **Generate human-readable reports**

   ```bash
   make report
   ```

   HTML report appears under `urgReport/urgReport.html`.
4. **Open interactive coverage in Verdi**

   ```bash
   make verdi
   ```

---

##  Outputs

* `simv.vdb/` → Coverage database (auto-generated by VCS).
* `urgReport/` → Reports generated by URG.
  
---

##  Coverage Results by Module

Update this table with your actual URG results after each run:

| Module                | Total | Line | Branch | Condition | Toggle | FSM  |
| --------------------- |------ | ---- | ------ | --------- | ------ | ---- |
| `spi_baud_generator`  |  93.31%    | 100%  | 100%    | 77.78%       | 95.45%    | - |
| `spi_slave_select`       |  97.77%    | 100%  | 100%    | 100%       | 91.07%    | -  |
| `spi_slave_interface`    |  -   | 98%  | 96%    | 94%       | 93%    | 100% |
| `spi_shift_reg` |  -   | 93%  | 87%    | 85%       | 89%    | 92%  |

---

##  Individual Module Reports

Click to view module-specific coverage reports (paths generated by URG):

* [spi_baud_generator Coverage](https://gokuljith-k.github.io/baud_generator/index.html)
* [spi_slave_select Coverage](https://gokuljith-k.github.io/slave_select/)
* [spi_slave_interface Coverage](./coverage_report/urgReport/files/rtl_spi_slave_select_v.html)
* [spi_shift_reg Coverage](./coverage_report/urgReport/files/rtl_spi_slave_interface_v.html)
* [top_mod Coverage](./coverage_report/urgReport/files/rtl_top_mod_v.html)

---
##  Coverage Waivers (Module-Specific Notes)

Certain coverage points are intentionally excluded because they are **not functionally reachable** or **not meaningful to test**.  
Below is the structured waiver documentation that can be reused for all modules.

---

### `spi_baud_generator`

####  Condition Coverage Waivers
- **Complementary CPOL/CPHA settings**  
  - In the SPI protocol, `CPOL` and `CPHA` combinations are complementary.  
  - This makes the `else` branch in certain conditions logically **unreachable**.  
  - URG flags this as uncovered, but it is **expected and acceptable**.  

####  Toggle Coverage Waivers
- **BaudRateDivisor LSB (bit[0])**  
  - By design, the Baud Rate Divisor is always an **even number**.  
  - This means `bit[0]` will always be `0` and **never toggles**.  
  - Waived since it is a *structural property* of the divider logic.

### `spi_slave_select`

####  Toggle Coverage Waivers
- **`target_s[3:0]` not toggling**  
  - The slave-select logic uses a counter up to `BaudRateDivisor / (2*16)`.  
  - Because of this, the **lowest 4 bits of `target_s` never toggle** during normal operation.  
  - URG marks this as uncovered, but it is **expected and waived**.  

---
##  How to Interpret Coverage Reports

* **Green highlight** = Covered.
* **Red highlight** = Uncovered → add new testcases.
* **Yellow highlight** = Partially covered.

---

##  Summary

* Run `make run` → compile + simulate with coverage enabled.
* Run `make report` → generate HTML/text coverage reports.
* Run `make verdi` → analyze coverage interactively.


---
